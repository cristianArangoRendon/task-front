@if (isLoading) {
    <app-loading message="Cargando métricas del dashboard"></app-loading>
}

@if (!isLoading) {
   

        @if (error) {
            <div class="error-state-section">
                <mat-card class="error-card">
                    <mat-card-content class="error-content">
                        <div class="error-icon-container">
                            <mat-icon class="error-icon">error_outline</mat-icon>
                        </div>
                        <div class="error-text">
                            <h3>Error al cargar las métricas</h3>
                            <p>{{ error }}</p>
                        </div>
                        <button
                            mat-raised-button
                            class="retry-btn"
                            (click)="loadMetrics()"
                        >
                            <mat-icon>replay</mat-icon>
                            Reintentar
                        </button>
                    </mat-card-content>
                </mat-card>
            </div>
        }

        @if (metrics && !error) {
            <div class="metrics-section">
                <div class="metrics-grid">
                    <mat-card class="metric-card total-tasks">
                        <mat-card-content>
                            <div class="card-header">
                                <div class="metric-icon-container">
                                    <mat-icon class="metric-icon">inventory_2</mat-icon>
                                </div>
                                <div class="metric-trend">
                                    <span class="trend-badge">Total</span>
                                </div>
                            </div>
                            <div class="metric-content">
                                <h2 class="metric-value">{{ metrics.totalTasks || 0 }}</h2>
                                <p class="metric-label">Tareas Totales</p>
                                <div class="metric-description">
                                    <mat-icon>info</mat-icon>
                                    <span>Todas las tareas activas del sistema</span>
                                </div>
                            </div>
                        </mat-card-content>
                    </mat-card>

                    <mat-card class="metric-card completed-tasks">
                        <mat-card-content>
                            <div class="card-header">
                                <div class="metric-icon-container">
                                    <mat-icon class="metric-icon">task_alt</mat-icon>
                                </div>
                                <div class="metric-trend">
                                    <span class="trend-badge positive">
                                        {{ metrics.completionPercentage || 0 | number:'1.0-0' }}%
                                    </span>
                                </div>
                            </div>
                            <div class="metric-content">
                                <h2 class="metric-value">{{ metrics.completedTasks || 0 }}</h2>
                                <p class="metric-label">Tareas Completadas</p>
                                <div class="progress-indicator">
                                    <div class="progress-background">
                                        <div 
                                            class="progress-fill positive"
                                            [style.width.%]="metrics.completionPercentage || 0"
                                        ></div>
                                    </div>
                                    <span class="progress-text">Progreso general</span>
                                </div>
                            </div>
                        </mat-card-content>
                    </mat-card>

                    <mat-card class="metric-card pending-tasks">
                        <mat-card-content>
                            <div class="card-header">
                                <div class="metric-icon-container">
                                    <mat-icon class="metric-icon">pending_actions</mat-icon>
                                </div>
                                <div class="metric-trend">
                                    <span class="trend-badge warning">
                                        {{ (100 - (metrics.completionPercentage || 0)) | number:'1.0-0' }}%
                                    </span>
                                </div>
                            </div>
                            <div class="metric-content">
                                <h2 class="metric-value">{{ metrics.pendingTasks || 0 }}</h2>
                                <p class="metric-label">Tareas Pendientes</p>
                                <div class="metric-description">
                                    <mat-icon>schedule</mat-icon>
                                    <span>Requieren atención inmediata</span>
                                </div>
                            </div>
                        </mat-card-content>
                    </mat-card>

                    <mat-card class="metric-card progress-card">
                        <mat-card-content>
                            <div class="card-header">
                                <div class="metric-icon-container">
                                    <mat-icon class="metric-icon">trending_up</mat-icon>
                                </div>
                                <div class="metric-trend">
                                    <span class="trend-badge info">Tendencia</span>
                                </div>
                            </div>
                            <div class="metric-content">
                                <h2 class="metric-value">{{ metrics.completionPercentage || 0 | number:'1.0-0' }}%</h2>
                                <p class="metric-label">Tasa de Completitud</p>
                                <div class="progress-container">
                                    <div class="circular-progress">
                                        <div class="progress-circle">
                                            <svg width="80" height="80" viewBox="0 0 120 120">
                                                <circle 
                                                    cx="60" 
                                                    cy="60" 
                                                    r="54" 
                                                    fill="none" 
                                                    stroke="#e0e0e0" 
                                                    stroke-width="8"
                                                />
                                                <circle 
                                                    cx="60" 
                                                    cy="60" 
                                                    r="54" 
                                                    fill="none" 
                                                    stroke="url(#progressGradient)" 
                                                    stroke-width="8"
                                                    stroke-linecap="round"
                                                    [attr.stroke-dasharray]="339.292"
                                                    [attr.stroke-dashoffset]="339.292 - (339.292 * (metrics.completionPercentage || 0)) / 100"
                                                    transform="rotate(-90 60 60)"
                                                />
                                                <defs>
                                                    <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                                        <stop offset="0%" stop-color="#667eea" />
                                                        <stop offset="100%" stop-color="#764ba2" />
                                                    </linearGradient>
                                                </defs>
                                            </svg>
                                            <div class="progress-text">
                                                <span>{{ metrics.completionPercentage || 0 | number:'1.0-0' }}%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="progress-stats">
                                        <div class="stat-item">
                                            <span class="stat-value">{{ metrics.completedTasks || 0 }}</span>
                                            <span class="stat-label">Completadas</span>
                                        </div>
                                        <div class="stat-divider"></div>
                                        <div class="stat-item">
                                            <span class="stat-value">{{ metrics.totalTasks || 0 }}</span>
                                            <span class="stat-label">Totales</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </mat-card-content>
                    </mat-card>
                </div>
            </div>
        }

        @if (!metrics && !error) {
            <div class="empty-state-section">
                <mat-card class="empty-card">
                    <mat-card-content class="empty-content">
                        <div class="empty-icon-container">
                            <mat-icon class="empty-icon">analytics</mat-icon>
                        </div>
                        <div class="empty-text">
                            <h3>No hay datos disponibles</h3>
                            <p>No se pudieron cargar las métricas de tareas en este momento</p>
                        </div>
                        <button
                            mat-raised-button
                            class="primary-btn"
                            (click)="loadMetrics()"
                        >
                            <mat-icon>refresh</mat-icon>
                            Cargar Métricas
                        </button>
                    </mat-card-content>
                </mat-card>
            </div>
        }

}